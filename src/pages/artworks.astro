---
import Layout from "../layouts/Layout.astro";

import { Image } from "astro:assets";

import config from "../data/config.json";
---

<Layout title="Artworks">
  <div class="h-screen overflow-auto">
    <div class="mt-[500px] h-2 bg-primary top-0 left-0 w-full"></div>
    <div class="h-2 bg-secondary top-0 left-0 w-full"></div>
    <div class="h-2 bg-accent top-0 left-0 w-full"></div>
    <div class="h-2 bg-green-500 top-0 left-0 w-full"></div>

    <section class="mt-24 fixed h-96 bg-primary top-0 left-0 w-full"></section>
    <section class="mt-24 h-96 fixed bg-secondary top-0 left-0 w-full">
    </section>
    <section class="mt-24 h-96 fixed bg-accent top-0 left-0 w-full"></section>
    <section class="mt-24 h-96 fixed bg-green-500 top-0 left-0 w-full">
    </section>
  </div>
</Layout>

<script>
  import gsap from "gsap";
  import { Observer } from "gsap/Observer";

  gsap.registerPlugin(Observer);

  const sections = document.querySelectorAll("section");

  let animating: boolean;
  let currentIndex: number = 0;
  let wrap = gsap.utils.wrap(0, sections.length);
  let t1: gsap.core.Timeline = gsap.timeline({
    defaults: { duration: 1.25, ease: "power1.inOut" },
    onComplete: () => {
      animating = false;
    },
  });

  const gotoSection = (index: number, direction: number) => {
    index = wrap(index);
    animating = true;

    // Reset the zIndex and autoAlpha for all sections except the current one
    sections.forEach((section, i) => {
      if (i !== currentIndex && i !== index) {
        gsap.set(section, { zIndex: 0, autoAlpha: 0 });
      }
    });

    gsap.set(sections[currentIndex], { zIndex: 10 });

    gsap.set(sections[index], { autoAlpha: 1, zIndex: 20 });
    t1.fromTo(sections[index], { yPercent: direction * 100 }, { yPercent: 0 });

    currentIndex = index;
  };

  Observer.create({
    type: "wheel,touch,pointer",
    wheelSpeed: -1,
    onDown: () => {
      console.log("Down");
      !animating && gotoSection(currentIndex - 1, -1);
    },
    onUp: () => !animating && gotoSection(currentIndex + 1, 1),
    tolerance: 10,
    preventDefault: true,
  });

  gotoSection(0, 1);
</script>
